{"ast":null,"code":"var _jsxFileName = \"C:\\\\react-auth\\\\client\\\\src\\\\context\\\\UserContext.js\",\n  _s = $RefreshSig$();\nimport { createContext, useState } from \"react\";\n//import Cookies from \"js-cookie\";\nimport { hashPassword, comparePassword } from '../helpers/auth';\nimport jwt from 'jsonwebtoken';\nimport { api } from \"../utils/apiHelper\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst UserContext = /*#__PURE__*/createContext(null);\nexport const UserProvider = props => {\n  _s();\n  const cookie = Cookies.get(\"authenticatedUser\");\n  const [authUser, setAuthUser] = useState(cookie ? JSON.parse(cookie) : null);\n  const signIn = async credentials => {\n    const response = await api(\"/users\", \"GET\", null, credentials);\n    if (response.status === 200) {\n      const user = await response.json();\n      setAuthUser(user);\n      const match = await comparePassword(credentials.password, user.password);\n      if (match) {\n        jwt.sign({\n          email: user.email,\n          id: user._id,\n          name: user.name,\n          kind: user.kind\n        }, process.env.TOKEN_SECRET, {}, (err, token) => {\n          if (err) throw err;\n          res.cookie('authenticatedUser', token).json(user);\n        });\n      }\n      if (!match) {\n        res.json({\n          error: \"Passwords do not match\"\n        });\n      }\n      return user;\n    } else if (response.status === 401) {\n      return null;\n    } else {\n      throw new Error();\n    }\n  };\n  const getProfile = (req, res) => {\n    const {\n      token\n    } = req.cookies;\n    if (token) {\n      jwt.verify(token, process.env.TOKEN_SECRET, {}, (err, user) => {\n        if (err) throw err;\n        res.json(user);\n      });\n    } else {\n      res.json(null);\n    }\n  };\n  const signOut = (req, res) => {\n    setAuthUser(null);\n    res.clearCookie('token');\n    return res.sendStatus(200);\n  };\n  return /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n    value: {\n      authUser,\n      actions: {\n        signIn,\n        signOut,\n        getProfile\n      }\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 5\n  }, this);\n};\n_s(UserProvider, \"LvsPIt5+Mr3Hdph5CnYejaZI3ac=\");\n_c = UserProvider;\nexport default UserContext;\nvar _c;\n$RefreshReg$(_c, \"UserProvider\");","map":{"version":3,"names":["createContext","useState","hashPassword","comparePassword","jwt","api","jsxDEV","_jsxDEV","UserContext","UserProvider","props","_s","cookie","Cookies","get","authUser","setAuthUser","JSON","parse","signIn","credentials","response","status","user","json","match","password","sign","email","id","_id","name","kind","process","env","TOKEN_SECRET","err","token","res","error","Error","getProfile","req","cookies","verify","signOut","clearCookie","sendStatus","Provider","value","actions","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/react-auth/client/src/context/UserContext.js"],"sourcesContent":["import { createContext, useState } from \"react\";\n//import Cookies from \"js-cookie\";\nimport { hashPassword, comparePassword} from '../helpers/auth';\nimport jwt from 'jsonwebtoken';\nimport { api } from \"../utils/apiHelper\";\n\nconst UserContext = createContext(null);\n\nexport const UserProvider = (props) => {\n  const cookie = Cookies.get(\"authenticatedUser\");\n  const [authUser, setAuthUser] = useState(cookie ? JSON.parse(cookie) : null);\n  \n  const signIn = async (credentials) => {\n  \n\n    const response = await api(\"/users\", \"GET\", null, credentials);\n    if (response.status === 200){\n     const user = await response.json();\n     setAuthUser(user);\n     const match = await comparePassword(credentials.password, user.password)\n     if(match) {\n      jwt.sign({email: user.email, id: user._id, name: user.name, kind: user.kind}, process.env.TOKEN_SECRET, {}, (err, token) => {\n          if(err) throw err;\n          res.cookie('authenticatedUser', token).json(user)\n            \n          })\n      }\n          if(!match) {\n            res.json({\n                error: \"Passwords do not match\"\n            })\n        }\n    return user\n       } else if (response.status === 401) {\n     return null\n   } else {\n     throw new Error();\n   } \n   \n  }\n\n  const getProfile = (req, res) => {\n    const {token} = req.cookies\n    if(token) {\n        jwt.verify(token, process.env.TOKEN_SECRET, {}, (err, user) => {\n            if(err) throw err;\n            res.json(user)\n        })\n    } else {\n      res.json(null)  \n    }\n    }\n    \n\n  const signOut = (req, res) => {\n      setAuthUser(null);\n      res.clearCookie('token');\n      return res.sendStatus(200);\n  }\n\n  return (\n    <UserContext.Provider value={{\n      authUser,\n      actions: {\n        signIn,\n        signOut,\n        getProfile\n      }\n    }}>\n      {props.children}\n    </UserContext.Provider>\n  );\n}\n\nexport default UserContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}